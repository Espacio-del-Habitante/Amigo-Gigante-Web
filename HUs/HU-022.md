# HU-022 — Gestión de Animales (UI/Diseño)

**Como** usuario de una fundación  
**Quiero** ver y gestionar la lista de animales de mi fundación en una tabla con filtros y búsqueda  
**Para** tener una vista clara y organizada de todos los animales disponibles para adopción

---

## Dependencias

- HU-005 (MUI configurado)
- HU-007 (Tailwind configurado)
- HU-008 (Design System centralizado)
- HU-010 (Atomic Design - componentes reutilizables)
- HU-014 (Formik y Yup configurados)
- HU-016 (Sistema de traducciones configurado)
- HU-018 (Layout del dashboard de fundaciones con sidebar) - **REQUERIDO**

---

## Contexto / Notas

- Esta HU implementa la **página de gestión de animales** con **solo UI y diseño**.
- La página muestra una tabla con animales, filtros, búsqueda y paginación.
- **Esta HU es solo UI**: no incluye integración con Supabase (eso va en HU-023).
- Los datos se mostrarán usando **mocks** para simular la funcionalidad.
- El layout del dashboard de fundaciones (HU-018) debe estar implementado antes de esta HU.
- Esta página será accesible en `/foundations/animals` (dentro del área de fundaciones).
- Los campos de la tabla se mapean a la estructura de BD:
  - `animals.id` → ID del animal (formato: #AG-XXXX)
  - `animals.name` → Nombre del animal
  - `animals.species` → Especie (dog/cat/etc)
  - `animals.breed` → Raza
  - `animals.status` → Estado (available/adopted/in_treatment/inactive)
  - `animals.created_at` → Fecha de admisión
  - `animals.cover_image_url` → Imagen de perfil
- **IMPORTANTE**: Al crear la rama para el PR, usar el nombre: `HU-022 - Gestión de Animales (UI)`

---

## Diseño (OBLIGATORIO)

Referencias:
- Diseño: `docs/design/code_animals_screen.html`
- Imagen: `docs/design/animals_screen.png`
- Design System: `docs/design/system.md`
- Esquema BD: `docs/scripts/db.sql`

Estructura de la página:
- **Header de la página**:
  - Título: "Animal Management"
  - Subtítulo: "Manage adoption profiles, edit details, and update statuses."
  - Botón primario: "+ Add New Animal" (solo UI, sin funcionalidad)
- **Barra de búsqueda y filtros**:
  - Campo de búsqueda con icono de lupa (placeholder: "Search by name, ID, or breed...")
  - Filtro de Status: dropdown con opciones (All, Available, Adopted, Pending, In Treatment, Inactive)
  - Filtro de Species: dropdown con opciones (All, Dog, Cat, Bird, Other)
  - Filtro de Orden: dropdown con opciones (Newest First, Oldest First, Name A-Z, Name Z-A)
- **Tabla de animales**:
  - Columnas: Profile, Name & ID, Species, Admission Date, Status, Actions
  - Filas con datos mockeados (mínimo 5 animales)
  - Cada fila muestra:
    - Imagen circular del animal (cover_image_url)
    - Nombre y ID (formato: #AG-XXXX)
    - Especie y raza (ej: "Dog (Golden Ret.)")
    - Fecha de admisión (formato: "Oct 12, 2023")
    - Badge de estado con colores según status
    - Botones de acción (Edit, Delete) que aparecen en hover (solo UI)
- **Paginación**:
  - Texto: "Showing 1 to 5 of 42 results"
  - Controles de paginación: flechas anterior/siguiente, números de página, ellipsis
  - Página actual destacada

Reglas:
- Usar tokens del Design System.
- La tabla debe ser responsive (scroll horizontal en móvil).
- Los filtros deben ser funcionales a nivel de UI (actualizar la tabla con datos mock).
- La búsqueda debe filtrar en tiempo real (client-side con mocks).
- Los badges de estado deben tener colores según el status:
  - Available: verde
  - Adopted: gris/azul claro
  - Pending: amarillo
  - In Treatment: naranja
  - Inactive: rojo/gris oscuro

---

## Alcance

Incluye:
- Crear página `/foundations/animals` (dentro del área de fundaciones)
- Implementar tabla completa con todas las columnas
- Implementar barra de búsqueda funcional (filtrado client-side con mocks)
- Implementar filtros de Status, Species y Sort (funcionales con mocks)
- Implementar paginación (UI funcional con datos mock)
- Crear componente de badge de estado reutilizable
- Crear mock de datos de animales (mínimo 5, idealmente 10-15 para probar paginación)
- Hacer la tabla responsive
- Agregar traducciones para todos los textos
- Usar el layout del dashboard (HU-018)
- Implementar estados hover en las filas de la tabla
- Botones de acción (Edit/Delete) visibles en hover

No incluye:
- Integración con Supabase para cargar datos reales
- Funcionalidad real de crear/editar/eliminar animales
- Upload de imágenes
- Navegación funcional a páginas de detalle/edición
- Lógica de negocio para gestionar animales
- Autenticación real (solo UI)

---

## Criterios de aceptación (Given / When / Then)

### 1) Página de gestión de animales creada

- **Dado** que necesito gestionar animales de mi fundación
- **Cuando** navego a la ruta `/foundations/animals`
- **Entonces** veo la página de gestión completa
- **Y** la página usa el layout del dashboard de fundaciones (HU-018)
- **Y** la página se carga sin errores
- **Y** el sidebar muestra "Animals" como activo

---

### 2) Header de la página implementado

- **Dado** que estoy en la página de gestión de animales
- **Cuando** observo el header
- **Entonces** veo:
  - Título "Animal Management"
  - Subtítulo descriptivo
  - Botón "+ Add New Animal" (solo UI, sin funcionalidad)
- **Y** el botón tiene el estilo primario del Design System

---

### 3) Barra de búsqueda y filtros implementada

- **Dado** que estoy en la página de gestión de animales
- **Cuando** observo la barra de búsqueda y filtros
- **Entonces** veo:
  - Campo de búsqueda con icono de lupa
  - Filtro de Status con dropdown
  - Filtro de Species con dropdown
  - Filtro de Sort con dropdown
- **Y** todos los elementos están alineados correctamente
- **Y** los filtros muestran el valor seleccionado

---

### 4) Búsqueda funcional (client-side con mocks)

- **Dado** que estoy en la página de gestión de animales
- **Cuando** escribo en el campo de búsqueda (nombre, ID o raza)
- **Entonces** la tabla se filtra en tiempo real
- **Y** solo se muestran los animales que coinciden con la búsqueda
- **Y** si no hay resultados, se muestra un mensaje apropiado

---

### 5) Filtros funcionales (client-side con mocks)

- **Dado** que estoy en la página de gestión de animales
- **Cuando** selecciono un filtro (Status, Species o Sort)
- **Entonces** la tabla se actualiza según el filtro seleccionado
- **Y** los filtros pueden combinarse (Status + Species + Sort)
- **Y** el filtro "All" muestra todos los animales

---

### 6) Tabla de animales implementada

- **Dado** que estoy en la página de gestión de animales
- **Cuando** observo la tabla
- **Entonces** veo todas las columnas:
  - Profile (imagen circular)
  - Name & ID (nombre y ID formateado)
  - Species (especie y raza)
  - Admission Date (fecha formateada)
  - Status (badge con color según estado)
  - Actions (botones Edit/Delete visibles en hover)
- **Y** la tabla muestra datos mockeados (mínimo 5 animales)
- **Y** las filas tienen hover effect

---

### 7) Badges de estado con colores correctos

- **Dado** que estoy en la tabla de animales
- **Cuando** observo los badges de estado
- **Entonces** cada status tiene el color correcto:
  - Available: verde
  - Adopted: gris/azul claro
  - Pending: amarillo
  - In Treatment: naranja
  - Inactive: rojo/gris oscuro
- **Y** los badges son legibles y accesibles

---

### 8) Paginación implementada

- **Dado** que estoy en la página de gestión de animales
- **Cuando** observo la paginación
- **Entonces** veo:
  - Texto con rango de resultados ("Showing 1 to 5 of 42 results")
  - Botones de navegación (anterior/siguiente)
  - Números de página
  - Página actual destacada
- **Y** la paginación funciona (cambia de página con datos mock)
- **Y** cuando hay muchas páginas, se muestra ellipsis

---

### 9) Layout responsive

- **Dado** que estoy en la página de gestión de animales
- **Cuando** cambio el tamaño de la ventana
- **Entonces** la tabla se adapta:
  - Scroll horizontal en móvil/tablet
  - Tabla completa visible en desktop
- **Y** los filtros se apilan verticalmente en móvil
- **Y** todos los elementos son legibles y accesibles

---

### 10) Traducciones implementadas

- **Dado** que se implementa la página de gestión de animales
- **Cuando** se revisa el código
- **Entonces** todos los textos usan `useTranslations` de `next-intl`
- **Y** existen traducciones en `src/messages/es/animals.json` y `src/messages/en/animals.json`
- **Y** los mensajes de estado y filtros también están traducidos
- **Y** no hay textos hardcodeados

---

### 11) Estados visuales y hover

- **Dado** que estoy en la tabla de animales
- **Cuando** paso el mouse sobre una fila
- **Entonces** la fila muestra efecto hover
- **Y** los botones de acción (Edit/Delete) aparecen
- **Y** los botones tienen estados hover y active

---

### 12) Mock de datos completo

- **Dado** que se implementa la página
- **Cuando** se revisa el mock de datos
- **Entonces** existe un archivo de mock con al menos 10-15 animales
- **Y** los animales tienen todos los campos necesarios:
  - id, name, species, breed, sex, age_months, size, status, cover_image_url, created_at
- **Y** los datos cubren diferentes estados y especies
- **Y** los IDs siguen el formato #AG-XXXX

---

## Reglas técnicas

### Arquitectura
- Presentation solo consume UseCases vía IoC (no importa repositorios concretos).
- Domain no importa React/Next/MUI/Tailwind/Inversify.
- Infrastructure contiene implementaciones y wiring IoC.
- **Esta HU es solo Presentation**: no toca Domain ni Infrastructure.
- **NO incluye integración con Supabase** (solo UI y mocks).

### UI
- Usar MUI para componentes base (Table, TextField, Select, Button, etc.).
- Tailwind se usa para layout/spacing/responsive utilities.
- Usar tokens del Design System (`brand-500`, `accent-500`, `neutral-*`).
- Los componentes deben ser reutilizables cuando sea posible.

### Tabla
- Usar `Table` de MUI para la estructura base.
- Implementar scroll horizontal en móvil.
- Usar `TableHead` y `TableBody` de MUI.
- Las filas deben tener hover effect.

### Filtros y búsqueda
- Implementar filtrado client-side con datos mock.
- La búsqueda debe filtrar por nombre, ID o raza.
- Los filtros deben poder combinarse.
- Usar `TextField` de MUI para búsqueda.
- Usar `Select` de MUI para filtros.

### Paginación
- Usar `Pagination` de MUI o componente personalizado.
- Implementar lógica de paginación client-side con datos mock.
- Mostrar rango de resultados.
- Manejar ellipsis cuando hay muchas páginas.

### Mock de datos
- Crear archivo `src/infrastructure/mocks/animals-management.mock.ts`.
- Incluir al menos 10-15 animales con datos variados.
- Los datos deben cubrir diferentes estados, especies y razas.
- Los IDs deben seguir el formato #AG-XXXX (ej: #AG-2309).

### Responsive
- Tabla con scroll horizontal en móvil/tablet.
- Filtros apilados verticalmente en móvil.
- Header responsive (botón full-width en móvil si es necesario).

### Traducciones (OBLIGATORIO)
- **TODOS los textos visibles en la UI deben estar traducidos** (español e inglés).
- Usar el sistema de traducciones configurado en HU-016 (`next-intl`).
- Agregar traducciones en:
  - `src/messages/es/animals.json` (español)
  - `src/messages/en/animals.json` (inglés)
- Incluir traducciones para:
  - Títulos y subtítulos
  - Labels de filtros
  - Opciones de filtros
  - Headers de tabla
  - Estados de animales
  - Mensajes de búsqueda sin resultados
  - Textos de paginación
- **NO hardcodear textos en español o inglés** en componentes.
- Usar `useTranslations('animals')` hook de `next-intl`.

### Layout
- **Usar el layout del dashboard de fundaciones creado en HU-018**.
- La página debe estar en `app/[locale]/foundations/animals/page.tsx`.
- El layout ya proporciona sidebar y header específicos para fundaciones.
- Solo accesible para usuarios con rol `foundation_user` (protección vía middleware).

### Dependencias / Paquetes
- No agregar dependencias nuevas salvo que esta HU lo indique explícitamente.
- MUI y Tailwind ya están instalados.
- Si aparece error 403/conectividad:
  1) Detenerse
  2) Pedir dominios requeridos
  3) Explicar por qué se requieren
  4) No continuar

### Git / Branching
- **Al crear la rama para el PR, usar el nombre**: `HU-022 - Gestión de Animales (UI)`

---

## Implementación sugerida

### Estructura de archivos sugerida:
```
src/app/[locale]/foundations/animals/
└── page.tsx                        # Página de gestión de animales

src/presentation/components/animals/
├── AnimalsManagementPage.tsx      # Componente principal de la página
├── AnimalsTable.tsx                # Tabla de animales
├── AnimalsSearchBar.tsx            # Barra de búsqueda y filtros
├── AnimalStatusBadge.tsx           # Badge de estado reutilizable
└── AnimalsPagination.tsx           # Componente de paginación

src/infrastructure/mocks/
└── animals-management.mock.ts      # Mock de datos de animales

src/messages/
├── es/
│   └── animals.json                # Traducciones en español
└── en/
    └── animals.json                 # Traducciones en inglés
```

### Componentes principales:

1. **AnimalsManagementPage** (`src/presentation/components/animals/AnimalsManagementPage.tsx`):
   - Componente principal que estructura la página
   - Maneja el estado de búsqueda, filtros y paginación
   - Filtra y pagina los datos mock en el cliente
   - Renderiza header, barra de búsqueda, tabla y paginación

2. **AnimalsTable**:
   - Tabla con todas las columnas
   - Renderiza filas con datos de animales
   - Maneja hover effects
   - Muestra botones de acción en hover

3. **AnimalsSearchBar**:
   - Campo de búsqueda
   - Filtros de Status, Species y Sort
   - Maneja cambios y actualiza el estado del filtrado

4. **AnimalStatusBadge**:
   - Badge reutilizable para estados
   - Colores según el status
   - Traducido

5. **AnimalsPagination**:
   - Componente de paginación
   - Muestra rango de resultados
   - Maneja navegación de páginas

### Estructura de datos mock sugerida:

```typescript
export interface AnimalManagement {
  id: number;
  name: string;
  species: string; // 'dog', 'cat', 'bird', etc.
  breed: string;
  sex: 'male' | 'female' | 'unknown';
  age_months: number | null;
  size: 'small' | 'medium' | 'large' | 'unknown';
  status: 'available' | 'adopted' | 'in_treatment' | 'inactive';
  cover_image_url: string | null;
  created_at: string; // ISO date string
}

export const mockAnimals: AnimalManagement[] = [
  {
    id: 2309,
    name: "Buddy",
    species: "dog",
    breed: "Golden Retriever",
    sex: "male",
    age_months: 24,
    size: "large",
    status: "available",
    cover_image_url: "https://...",
    created_at: "2023-10-12T00:00:00Z"
  },
  // ... más animales
];
```

### Estructura de traducciones sugerida:

**src/messages/es/animals.json:**
```json
{
  "title": "Gestión de Animales",
  "subtitle": "Gestiona perfiles de adopción, edita detalles y actualiza estados.",
  "addButton": "Agregar Nuevo Animal",
  "search": {
    "placeholder": "Buscar por nombre, ID o raza...",
    "noResults": "No se encontraron animales"
  },
  "filters": {
    "status": {
      "label": "Estado",
      "all": "Todos",
      "available": "Disponible",
      "adopted": "Adoptado",
      "pending": "Pendiente",
      "in_treatment": "En Tratamiento",
      "inactive": "Inactivo"
    },
    "species": {
      "label": "Especie",
      "all": "Todas",
      "dog": "Perro",
      "cat": "Gato",
      "bird": "Ave",
      "other": "Otro"
    },
    "sort": {
      "label": "Ordenar",
      "newest": "Más Recientes",
      "oldest": "Más Antiguos",
      "nameAsc": "Nombre A-Z",
      "nameDesc": "Nombre Z-A"
    }
  },
  "table": {
    "columns": {
      "profile": "Perfil",
      "nameId": "Nombre e ID",
      "species": "Especie",
      "admissionDate": "Fecha de Admisión",
      "status": "Estado",
      "actions": "Acciones"
    },
    "actions": {
      "edit": "Editar",
      "delete": "Eliminar"
    }
  },
  "pagination": {
    "showing": "Mostrando {from} a {to} de {total} resultados"
  }
}
```

**src/messages/en/animals.json:**
```json
{
  "title": "Animal Management",
  "subtitle": "Manage adoption profiles, edit details, and update statuses.",
  "addButton": "Add New Animal",
  "search": {
    "placeholder": "Search by name, ID, or breed...",
    "noResults": "No animals found"
  },
  "filters": {
    "status": {
      "label": "Status",
      "all": "All",
      "available": "Available",
      "adopted": "Adopted",
      "pending": "Pending",
      "in_treatment": "In Treatment",
      "inactive": "Inactive"
    },
    "species": {
      "label": "Species",
      "all": "All",
      "dog": "Dog",
      "cat": "Cat",
      "bird": "Bird",
      "other": "Other"
    },
    "sort": {
      "label": "Sort",
      "newest": "Newest First",
      "oldest": "Oldest First",
      "nameAsc": "Name A-Z",
      "nameDesc": "Name Z-A"
    }
  },
  "table": {
    "columns": {
      "profile": "Profile",
      "nameId": "Name & ID",
      "species": "Species",
      "admissionDate": "Admission Date",
      "status": "Status",
      "actions": "Actions"
    },
    "actions": {
      "edit": "Edit",
      "delete": "Delete"
    }
  },
  "pagination": {
    "showing": "Showing {from} to {to} of {total} results"
  }
}
```

### Notas de implementación:
- Usar `Table`, `TableHead`, `TableBody`, `TableRow`, `TableCell` de MUI.
- Implementar filtrado client-side con `useMemo` o `useState`.
- La paginación puede usar `Pagination` de MUI o componente personalizado.
- Los badges pueden usar `Chip` de MUI con colores personalizados.
- Los iconos pueden ser de `@mui/icons-material` o Material Symbols.
- El formato de fecha puede usar `Intl.DateTimeFormat` o librería de fechas.

---

## Validación

Comandos mínimos:
- `npm run dev` (verificar que la página se carga correctamente)
- `npm run build` (verificar que no hay errores de compilación)

Verificaciones visuales:
- La página se ve igual al diseño de referencia
- La búsqueda filtra correctamente
- Los filtros funcionan y se pueden combinar
- La paginación funciona
- La tabla es responsive
- Los badges tienen los colores correctos
- Las traducciones funcionan correctamente
- No hay textos hardcodeados
- Los hover effects funcionan

---

## Definición de Hecho

- [ ] Criterios de aceptación cumplidos
- [ ] `npm run dev` OK
- [ ] `npm run build` OK
- [ ] Página de gestión de animales creada y accesible
- [ ] Tabla completa con todas las columnas
- [ ] Búsqueda funcional (client-side con mocks)
- [ ] Filtros funcionales (client-side con mocks)
- [ ] Paginación implementada y funcional
- [ ] Badges de estado con colores correctos
- [ ] Mock de datos completo (mínimo 10-15 animales)
- [ ] Layout responsive
- [ ] Estados visuales y hover implementados
- [ ] **Traducciones incluidas**:
  - [ ] Textos agregados en `src/messages/es/animals.json`
  - [ ] Textos agregados en `src/messages/en/animals.json`
  - [ ] Componentes usan `useTranslations` (no textos hardcodeados)
  - [ ] Keys consistentes entre idiomas
- [ ] Uso correcto de tokens del Design System
- [ ] Layout del dashboard de fundaciones (HU-018) usado correctamente
- [ ] Sin violaciones de capas
- [ ] Sin cambios fuera del alcance
- [ ] Rama creada con nombre: `HU-022 - Gestión de Animales (UI)`
- Commit sugerido:
  `feat: add animals management page UI with table, filters and pagination`

