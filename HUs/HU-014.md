# HU-014 — Implementación de formulario de registro con Formik y Yup

**Como** usuario de una fundación  
**Quiero** completar el formulario de registro con validaciones robustas  
**Para** asegurarme de que los datos ingresados sean correctos antes de enviar

---

## Dependencias

- HU-012 (Formulario de registro UI implementado)
- HU-013 (Estrategia de roles y protección de rutas definida)

---

## Contexto / Notas

- Esta HU implementa la **funcionalidad del formulario** con validaciones usando Formik y Yup.
- No incluye la conexión con Supabase (eso va en HU-015).
- El formulario debe validar todos los campos según las reglas de negocio.
- Se debe mostrar feedback visual claro al usuario sobre errores y estado del formulario.
- Formik maneja el estado del formulario y Yup valida los datos.

---

## Alcance

Incluye:
- Instalación de Formik y Yup
- Integración de Formik con el formulario existente
- Definición de esquema de validación con Yup
- Validación de todos los campos (Foundation Name, Email, Tax ID, Password, Confirm Password)
- Manejo de estados del formulario (loading, errors, touched)
- Mostrar mensajes de error debajo de cada campo
- Deshabilitar botón de envío mientras se valida/envía
- Validación en tiempo real (onBlur) y al enviar

No incluye:
- Conexión con Supabase para registrar
- Lógica de negocio de registro
- Redirección después del registro
- Manejo de errores del servidor (solo validación cliente)

---

## Criterios de aceptación (Given / When / Then)

### 1) Formik y Yup instalados

- **Dado** que se necesita validación de formularios
- **Cuando** se instalan las dependencias
- **Entonces** existen en `package.json`:
  - `formik`
  - `yup`
- **Y** están instaladas correctamente

---

### 2) Formik integrado con el formulario

- **Dado** que existe el formulario de registro (HU-012)
- **Cuando** se integra Formik
- **Entonces** el formulario usa `useFormik` o `<Formik>`
- **Y** los campos están conectados con `getFieldProps` o `Field`
- **Y** el formulario mantiene su diseño visual

---

### 3) Esquema de validación con Yup

- **Dado** que se necesita validar los campos
- **Cuando** se crea el esquema de validación
- **Entonces** existe un esquema Yup que valida:
  - Foundation Name: requerido, mínimo 3 caracteres
  - Official Email: requerido, formato de email válido
  - Tax ID: opcional, si se ingresa debe tener formato válido
  - Password: requerido, mínimo 6 caracteres
  - Confirm Password: requerido, debe coincidir con Password
- **Y** los mensajes de error son claros y en español

---

### 4) Validación de Foundation Name

- **Dado** que el usuario completa el campo Foundation Name
- **Cuando** el campo está vacío o tiene menos de 3 caracteres
- **Entonces** se muestra un mensaje de error
- **Y** el mensaje aparece cuando el campo pierde el foco o al enviar

---

### 5) Validación de Email

- **Dado** que el usuario completa el campo Official Email
- **Cuando** el email está vacío o tiene formato inválido
- **Entonces** se muestra un mensaje de error apropiado
- **Y** la validación verifica formato de email correcto

---

### 6) Validación de Tax ID

- **Dado** que el campo Tax ID es opcional
- **Cuando** el usuario deja el campo vacío
- **Entonces** no se muestra error (es opcional)
- **Y** cuando el usuario ingresa un valor, se valida el formato si aplica

---

### 7) Validación de Password

- **Dado** que el usuario completa el campo Password
- **Cuando** el password está vacío o tiene menos de 6 caracteres
- **Entonces** se muestra un mensaje de error
- **Y** el mensaje indica el mínimo de caracteres requeridos

---

### 8) Validación de Confirm Password

- **Dado** que el usuario completa el campo Confirm Password
- **Cuando** el valor no coincide con Password
- **Entonces** se muestra un mensaje de error indicando que no coinciden
- **Y** la validación se ejecuta cuando ambos campos tienen valor

---

### 9) Estados visuales del formulario

- **Dado** que el formulario tiene validaciones
- **Cuando** hay errores de validación
- **Entonces** los campos con error muestran:
  - Borde de color de error (rojo o según Design System)
  - Mensaje de error debajo del campo
- **Y** el botón de envío está deshabilitado si hay errores

---

### 10) Estado de loading

- **Dado** que el formulario se está enviando
- **Cuando** se hace clic en "Register Foundation"
- **Entonces** el botón muestra estado de loading
- **Y** el botón está deshabilitado durante el envío
- **Y** los campos están deshabilitados durante el envío

---

## Reglas técnicas

### Arquitectura
- Presentation solo consume UseCases vía IoC (no importa repositorios concretos).
- Domain no importa React/Next/MUI/Tailwind/Inversify/Formik/Yup.
- Infrastructure contiene implementaciones y wiring IoC.
- **Formik y Yup solo en Presentation**: en los componentes del formulario.

### Validación
- Usar Yup para definir el esquema de validación.
- Los mensajes de error deben ser claros y en español.
- Validar en `onBlur` (cuando el campo pierde el foco) y al enviar.
- No validar mientras el usuario está escribiendo (solo onBlur y onSubmit).

### Integración con MUI
- Usar `TextField` de MUI con `error` y `helperText` para mostrar errores.
- Conectar los campos con `getFieldProps` de Formik.
- Mantener el diseño visual del formulario existente.

### Dependencias / Paquetes
- Instalar `formik` y `yup` como dependencias.
- Si aparece error 403/conectividad:
  1) Detenerse
  2) Pedir dominios requeridos
  3) Explicar por qué se requieren
  4) No continuar

---

## Implementación sugerida

### Estructura de archivos sugerida:

```
src/presentation/
├── components/
│   └── register/
│       ├── RegisterForm.tsx          # Formulario con Formik
│       └── registerValidation.ts     # Esquema Yup
└── hooks/
    └── useRegisterForm.ts            # Hook opcional para lógica del formulario
```

### Flujo de implementación:

1. **Instalar dependencias**:
   ```bash
   npm install formik yup
   ```

2. **Crear esquema de validación**:
   - `registerValidation.ts` con esquema Yup
   - Validar todos los campos según criterios

3. **Integrar Formik en RegisterForm**:
   - Usar `useFormik` o `<Formik>`
   - Conectar campos con `getFieldProps`
   - Manejar `onSubmit` (por ahora solo console.log o TODO)

4. **Conectar campos MUI con Formik**:
   - Usar `error={touched.field && !!errors.field}`
   - Usar `helperText={touched.field && errors.field}`

5. **Manejar estados**:
   - `isSubmitting` para deshabilitar botón
   - `touched` para mostrar errores solo cuando corresponda
   - `errors` para mensajes de error

### Ejemplo de esquema Yup:

```typescript
import * as Yup from 'yup';

export const registerSchema = Yup.object().shape({
  foundationName: Yup.string()
    .required('El nombre de la fundación es requerido')
    .min(3, 'El nombre debe tener al menos 3 caracteres'),
  officialEmail: Yup.string()
    .required('El email oficial es requerido')
    .email('El email debe tener un formato válido'),
  taxId: Yup.string().optional(),
  password: Yup.string()
    .required('La contraseña es requerida')
    .min(6, 'La contraseña debe tener al menos 6 caracteres'),
  confirmPassword: Yup.string()
    .required('Debes confirmar la contraseña')
    .oneOf([Yup.ref('password')], 'Las contraseñas no coinciden'),
  acceptTerms: Yup.boolean()
    .required('Debes aceptar los términos y condiciones')
    .oneOf([true], 'Debes aceptar los términos y condiciones'),
});
```

---

## Validación

Comandos mínimos:
- `npm run dev` (verificar que el formulario funciona)
- `npm run build` (verificar que no hay errores de compilación)

Verificaciones:
- El formulario valida todos los campos correctamente
- Los mensajes de error se muestran cuando corresponda
- El botón se deshabilita cuando hay errores
- El estado de loading funciona
- El diseño visual se mantiene igual

---

## Definición de Hecho

- [ ] Criterios de aceptación cumplidos
- [ ] `npm run dev` OK
- [ ] `npm run build` OK
- [ ] Formik y Yup instalados
- [ ] Formik integrado con el formulario
- [ ] Esquema de validación Yup creado
- [ ] Todas las validaciones funcionan correctamente
- [ ] Estados visuales funcionan (errores, loading)
- [ ] Mensajes de error en español y claros
- [ ] Sin violaciones de capas
- [ ] Sin cambios fuera del alcance
- Commit sugerido:
  `feat: add formik and yup validation to registration form`

