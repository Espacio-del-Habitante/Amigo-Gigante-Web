# HU-032 — Modal Genérico de Eliminación + Eliminar Animal

**Como** usuario de una fundación  
**Quiero** eliminar un animal con confirmación  
**Para** evitar eliminaciones accidentales

---

## Dependencias

- HU-011 (Conexión a Supabase configurada)
- HU-016 (Sistema de traducciones configurado)
- HU-018 (Layout del dashboard de fundaciones con sidebar) - **REQUERIDO**
- HU-023 (Gestión de animales con Supabase) - **REQUERIDO**
- HU-031 (Editar animal) - **REQUERIDO**

---

## Contexto / Notas

- Esta HU implementa un **modal genérico de eliminación** reutilizable para otras entidades.
- Se usa para eliminar animales en la gestión de animales.
- El diseño está en `docs/design/delete_generic_screen.png` y `docs/design/delete_generic_.html`.
- El modal debe recibir props de configuración (título, mensaje, confirmación, callback).
- La eliminación real se realiza en Supabase (`animals`).

Modelo de datos:
- `animals`: `id`, `foundation_id`, `name`, `status`, `is_published`
- `animal_photos`: `animal_id`, `url`

---

## Diseño (OBLIGATORIO)

Referencias:
- Diseño: `docs/design/delete_generic_.html`
- Imagen: `docs/design/delete_generic_screen.png`
- Design System: `docs/design/system.md`

Estructura del modal:
- Ícono de advertencia
- Título: “¿Estás seguro de eliminar este producto?” (adaptable)
- Texto descriptivo
- Botón “Cancelar”
- Botón “Sí, eliminar” (primario rojo)
- Fondo con overlay y blur

Reglas:
- Modal centrado
- Overlay oscurecido
- Acciones visibles
- Responsive

---

## Alcance

Incluye:
- Crear componente `ConfirmDeleteModal` reutilizable
- Propiedades configurables: title, description, confirmLabel, cancelLabel
- Hook o handler de confirmación
- Integración en gestión de animales:
  - Botón eliminar abre modal
  - Confirmación elimina en Supabase
  - Refresca tabla
- Estados de loading y error
- Traducciones completas (ES/EN)

No incluye:
- Eliminación de otras entidades (se habilitará en HUs futuras)
- Undo de eliminación
- Tests automatizados

---

## Criterios de aceptación (Given / When / Then)

### 1) Modal genérico creado

- **Dado** que necesito confirmar eliminación
- **Cuando** se abre el modal
- **Entonces** se muestra con el diseño definido
- **Y** los textos son configurables

---

### 2) Modal reutilizable

- **Dado** que el modal es genérico
- **Cuando** lo reutilizo para otras entidades
- **Entonces** puedo cambiar título y mensaje sin reescribir el componente

---

### 3) Eliminación de animal

- **Dado** un animal en la tabla
- **Cuando** hago clic en eliminar y confirmo
- **Entonces** se elimina en Supabase
- **Y** desaparece de la tabla

---

### 4) Restricción por fundación

- **Dado** un usuario de fundación
- **Cuando** intenta eliminar un animal
- **Entonces** solo puede eliminar animales de su propia fundación

---

### 5) Estados de loading y error

- **Dado** que se elimina un animal
- **Cuando** Supabase procesa la solicitud
- **Entonces** se muestra loading
- **Y** si hay error se muestra mensaje traducido

---

### 6) Traducciones

- **Dado** la UI implementada
- **Cuando** se revisa el código
- **Entonces** todos los textos usan `useTranslations`
- **Y** existen traducciones en `src/messages/es/common.json` y `src/messages/en/common.json`

---

## Reglas técnicas

### Arquitectura
- Presentation solo consume UseCases vía IoC.
- Domain no importa React/Next/MUI/Tailwind/Inversify/Supabase.
- Infrastructure contiene implementaciones y wiring IoC.
- Supabase solo vive en Infrastructure.

### Supabase / Eliminación
- `DELETE FROM animals WHERE id = :id AND foundation_id = :foundationId`
- Si hay `animal_photos`, se eliminan en cascada (FK con `ON DELETE CASCADE`).

### Traducciones
- Usar namespace `common` para textos de modal genérico.
- No hardcodear textos.

---

## Implementación sugerida

```
src/presentation/components/common/
└── ConfirmDeleteModal.tsx

src/domain/
└── usecases/animals/
    └── DeleteAnimalUseCase.ts

src/infrastructure/
└── repositories/
    └── AnimalRepository.ts (deleteAnimal)

src/messages/
├── es/
│   └── common.json
└── en/
    └── common.json
```

---

## Validación

Comandos mínimos:
- `npm run dev`
- `npm run build`

Verificaciones:
- Modal se ve igual al diseño
- Eliminación funciona
- Traducciones completas

---

## Definición de Hecho

- [ ] Criterios de aceptación cumplidos
- [ ] `npm run dev` OK
- [ ] `npm run build` OK
- [ ] Modal genérico creado y reutilizable
- [ ] Eliminación de animales funciona
- [ ] Traducciones incluidas (ES/EN)
- [ ] Sin violaciones de capas
- [ ] Sin cambios fuera del alcance
- Commit sugerido:
  `feat: add generic delete modal and delete animal flow`

