# HU-027 — Detalle de Animal en Adopción (UI + Supabase)

**Como** usuario externo  
**Quiero** ver el detalle completo de un animal del catálogo  
**Para** conocer su historia, fotos y características antes de adoptar

---

## Dependencias

- HU-001 (Next.js App Router)
- HU-007 (Tailwind configurado)
- HU-010 (Atomic Design - componentes reutilizables)
- HU-011 (Conexión a Supabase configurada)
- HU-016 (Sistema de traducciones configurado)
- HU-026 (Catálogo de adopción implementado) - **REQUERIDO**

---

## Contexto / Notas

- Esta HU implementa la **vista de detalle** de un animal desde el catálogo público.
- La UI debe seguir el diseño de `docs/design/info_adopt_screen.png` y `docs/design/info_adopt_code.html`.
- La ruta debe ser `/adopt/[id]` (o `app/[locale]/adopt/[id]/page.tsx`).
- La data proviene de Supabase (`animals` y `animal_photos`).
- Solo se muestran animales `is_published = true`.
- El diseño incluye secciones no soportadas por la BD (historial, salud):
  - **No se inventan datos**; se ocultan o se muestran placeholders de “sin datos”.

Modelo de datos disponible:
- `animals`: `id`, `name`, `species`, `breed`, `sex`, `age_months`, `size`, `status`, `description`, `cover_image_url`, `is_published`, `created_at`
- `animal_photos`: `animal_id`, `url`, `sort_order`

---

## Diseño (OBLIGATORIO)

Referencias:
- Diseño: `docs/design/info_adopt_code.html`
- Imagen: `docs/design/info_adopt_screen.png`
- Design System: `docs/design/system.md`
- Esquema BD: `docs/scripts/db.sql`

Estructura del detalle:
- **Breadcrumbs**: Perros > Adopciones > [Nombre]
- **Galería**:
  - Imagen principal (cover)
  - Thumbnails (fotos adicionales)
  - Botón de favorito (UI)
  - Badge de status (Disponible)
- **Panel de información**:
  - Nombre
  - Ubicación (no disponible en BD → ocultar o placeholder)
  - Edad (derivada de `age_months`)
  - Chips (sexo, tamaño, especie)
  - Descripción completa
  - CTA: Adoptar / Apadrinar (UI)
- **Sección “Historial”** (no disponible en BD → ocultar o placeholder)
- **Sección “Otros amigos buscando hogar”** (recomendados)

---

## Alcance

Incluye:
- Crear página `/adopt/[id]`
- Obtener detalle del animal desde Supabase
- Obtener fotos desde `animal_photos`
- Mostrar galería con imagen principal y thumbnails
- Mostrar datos reales: nombre, edad, sexo, especie, tamaño, descripción, status
- Mostrar CTA de adopción (sin flujo real)
- Mostrar animales recomendados (otros `available` publicados)
- Manejar estado de loading y error
- Traducciones completas (ES/EN)

No incluye:
- Historial clínico o eventos (no existe en BD)
- Estado de salud (vacunado, esterilizado, etc.)
- Ubicación real (no existe en BD)
- Favoritos reales
- Flujo real de adopción/apadrinamiento
- Tests automatizados

---

## Criterios de aceptación (Given / When / Then)

### 1) Ruta de detalle creada

- **Dado** un animal en el catálogo
- **Cuando** hago clic en “Details”
- **Entonces** navego a `/adopt/[id]`
- **Y** veo la página de detalle

---

### 2) Datos del animal cargados

- **Dado** un animal publicado en Supabase
- **Cuando** carga la página
- **Entonces** se obtiene `animals` por `id`
- **Y** se muestran nombre, especie, sexo, tamaño, descripción, edad

---

### 3) Galería de fotos

- **Dado** que existen fotos en `animal_photos`
- **Cuando** se muestra la galería
- **Entonces** la imagen principal es `cover_image_url` o la primera foto
- **Y** los thumbnails muestran las demás fotos

---

### 4) Edad derivada

- **Dado** `age_months`
- **Cuando** se muestra la edad
- **Entonces** se formatea a años/meses según regla:
  - >= 12 → “X años”
  - < 12 → “X meses”

---

### 5) Status visible

- **Dado** `status` en BD
- **Cuando** se renderiza la card principal
- **Entonces** se muestra badge de estado traducido
- **Y** solo se permite acceder si `is_published = true`

---

### 6) Secciones sin datos en BD

- **Dado** que no existe “historial” ni “salud”
- **Cuando** se renderiza la página
- **Entonces** esas secciones se ocultan o muestran texto “sin información”
- **Y** no se inventan datos

---

### 7) Recomendados

- **Dado** el animal actual
- **Cuando** carga la sección “Otros amigos buscando hogar”
- **Entonces** se consultan otros animales `available` publicados
- **Y** se muestran en cards
- **Y** no incluye al animal actual

---

### 8) Estado de loading

- **Dado** que se consulta Supabase
- **Cuando** carga la página
- **Entonces** se muestra un estado de loading
- **Y** desaparece al finalizar

---

### 9) Manejo de errores

- **Dado** que el animal no existe o hay error
- **Cuando** se consulta Supabase
- **Entonces** se muestra un mensaje traducido
- **Y** la UI no se rompe

---

### 10) Traducciones

- **Dado** que se implementa la UI
- **Cuando** se revisa el código
- **Entonces** todos los textos usan `useTranslations`
- **Y** existen traducciones en `src/messages/es/adopt-detail.json` y `src/messages/en/adopt-detail.json`

---

## Reglas técnicas

### Arquitectura
- Presentation solo consume UseCases vía IoC.
- Domain no importa React/Next/MUI/Tailwind/Inversify/Supabase.
- Infrastructure contiene implementaciones y wiring IoC.
- Supabase solo vive en Infrastructure.

### Supabase / Queries
- Detalle:
  - `SELECT * FROM animals WHERE id = :id AND is_published = true`
- Fotos:
  - `SELECT * FROM animal_photos WHERE animal_id = :id ORDER BY sort_order`
- Recomendados:
  - `SELECT * FROM animals WHERE status = 'available' AND is_published = true AND id != :id LIMIT 4`

### Traducciones
- Usar `useTranslations('adoptDetail')`.
- No hardcodear textos.

### Dependencias / Paquetes
- No agregar dependencias nuevas.

---

## Implementación sugerida

### Estructura de archivos sugerida:
```
src/app/[locale]/adopt/[id]/page.tsx

src/presentation/components/adopt-detail/
├── AdoptDetailPage.tsx
├── AdoptBreadcrumbs.tsx
├── AdoptGallery.tsx
├── AdoptInfoPanel.tsx
├── AdoptHistory.tsx (opcional, placeholder)
└── AdoptRelatedGrid.tsx

src/domain/
├── models/
│   └── AdoptDetail.ts
├── repositories/
│   └── IAnimalRepository.ts (extender con getAdoptDetail, getRelatedAnimals)
└── usecases/
    └── adopt/
        └── GetAdoptDetailUseCase.ts

src/infrastructure/
├── repositories/
│   └── AnimalRepository.ts (implementar getAdoptDetail, getRelatedAnimals)
└── ioc/
    └── bindings actualizados

src/messages/
├── es/
│   └── adopt-detail.json
└── en/
    └── adopt-detail.json
```

---

## Validación

Comandos mínimos:
- `npm run dev`
- `npm run build`

Verificaciones:
- Vista coincide con el diseño
- Datos reales desde Supabase
- Galería funcional
- Recomendados funcionan
- Traducciones completas

---

## Definición de Hecho

- [ ] Criterios de aceptación cumplidos
- [ ] `npm run dev` OK
- [ ] `npm run build` OK
- [ ] Vista de detalle creada y funcional
- [ ] Datos reales desde Supabase
- [ ] Galería de fotos funcionando
- [ ] Recomendados funcionando
- [ ] Traducciones incluidas (ES/EN)
- [ ] Sin violaciones de capas
- [ ] Sin cambios fuera del alcance
- Commit sugerido:
  `feat: add adopt animal detail with supabase data`

