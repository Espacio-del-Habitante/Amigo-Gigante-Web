# HU-026 — Catálogo de Adopción (UI + Supabase)

**Como** usuario externo  
**Quiero** navegar al catálogo de adopción desde el navbar  
**Para** ver animales disponibles y filtrar por mis preferencias

---

## Dependencias

- HU-001 (Next.js App Router)
- HU-007 (Tailwind configurado)
- HU-010 (Atomic Design - componentes reutilizables)
- HU-011 (Conexión a Supabase configurada)
- HU-016 (Sistema de traducciones configurado)

---

## Contexto / Notas

- Esta HU implementa el **catálogo público de adopción** con filtros, búsqueda y paginación.
- La UI debe seguir el diseño de `docs/design/adopt_screen.png` y `docs/design/adopt_code.html`.
- La ruta debe estar en `/adopt` (o `app/[locale]/adopt/page.tsx`).
- La data proviene de Supabase usando el modelo `animals` y `animal_photos` en `docs/scripts/db.sql`.
- **Solo se muestran animales disponibles** y publicados:
  - `status = 'available'`
  - `is_published = true`
- Si un animal no tiene `cover_image_url`, se usa la primera foto de `animal_photos` (si existe).
- Algunos elementos del diseño **no existen en la BD** (p. ej. “Urgent Need”):
  - Se adaptan con reglas derivadas de campos existentes (ver reglas técnicas).

Modelo de datos disponible (según `docs/scripts/db.sql`):
- Tabla `animals`:
  - `id`, `foundation_id`, `name`, `species`, `breed`, `sex`, `age_months`, `size`, `status`, `description`, `cover_image_url`, `is_published`, `created_at`
- Tabla `animal_photos` (relación 1:N):
  - `id`, `animal_id`, `url`, `sort_order`

---

## Diseño (OBLIGATORIO)

Referencias:
- Diseño: `docs/design/adopt_code.html`
- Imagen: `docs/design/adopt_screen.png`
- Design System: `docs/design/system.md`
- Esquema BD: `docs/scripts/db.sql`

Estructura del catálogo:
- **Navbar** (con opción “Adopta” activa)
- **Hero**:
  - Título principal
  - Subtítulo descriptivo
- **Sidebar de filtros**:
  - Toggle “Urgent Need” (adaptado a reglas derivadas)
  - Animal Type (Dogs, Cats, Others)
  - Age (Puppy, Young, Adult, Senior)
  - Size (Small, Medium, Large)
- **Barra superior**:
  - Search input (placeholder “Search by name, breed...”)
  - Sort dropdown (Newest Arrivals, Oldest Arrivals, Urgent Need)
- **Grid de cards**:
  - Imagen del animal
  - Nombre
  - Badge de sexo
  - Descripción corta
  - Edad y tamaño
  - CTA: “Adopt” + “Details”
- **Paginación** al final
- **Footer** público

Reglas:
- Respetar la jerarquía visual del diseño.
- Usar tokens del Design System.
- Grid responsive (1/2/3 columnas según breakpoints).
- Sidebar sticky en desktop.
- Paginación funcional.

---

## Alcance

Incluye:
- Crear página pública `/adopt`
- Renderizar el catálogo según diseño
- Traer animales desde Supabase
- Filtrar por:
  - Species (dog/cat/other)
  - Size (small/medium/large)
  - Age (derivado de `age_months`)
  - “Urgent Need” (derivado de `created_at` y/o `age_months`)
- Buscar por nombre y raza
- Ordenar por:
  - Newest Arrivals (`created_at DESC`)
  - Oldest Arrivals (`created_at ASC`)
  - Urgent Need (regla derivada)
- Paginación server-side
- Mostrar solo `status = available` y `is_published = true`
- Mostrar fallback de imagen usando `animal_photos`
- Botón “Details” navega a `/adopt/[id]` (HU-027)
- Traducciones completas (ES/EN)
- Estados de loading y error

No incluye:
- Favoritos reales (botón corazón solo UI)
- Adopción real (CTA “Adopt” sin flujo backend)
- Patrocinio real
- Sistema de solicitudes
- Tests automatizados

---

## Criterios de aceptación (Given / When / Then)

### 1) Ruta del catálogo creada

- **Dado** que navego al sitio
- **Cuando** hago clic en “Adopta” en el navbar
- **Entonces** navego a `/adopt`
- **Y** veo el catálogo completo

---

### 2) Catálogo muestra animales disponibles

- **Dado** animales con `status = 'available'` y `is_published = true`
- **Cuando** carga el catálogo
- **Entonces** se listan solo esos animales
- **Y** no aparecen animales `adopted`, `inactive` o no publicados

---

### 3) Imágenes con fallback

- **Dado** un animal sin `cover_image_url`
- **Cuando** se renderiza la card
- **Entonces** se usa la primera foto de `animal_photos` (sort_order asc)
- **Y** si no hay fotos, se muestra placeholder

---

### 4) Búsqueda funcional

- **Dado** que escribo un término en el search
- **Cuando** busco por nombre o raza
- **Entonces** se filtran los animales por `name` o `breed`
- **Y** la búsqueda es case-insensitive

---

### 5) Filtros por especie y tamaño

- **Dado** filtros seleccionados
- **Cuando** aplico Species/Size
- **Entonces** se actualiza el listado con los resultados
- **Y** los filtros pueden combinarse

---

### 6) Filtro por edad (derivado)

- **Dado** el filtro de edad
- **Cuando** selecciono Puppy/Young/Adult/Senior
- **Entonces** se filtra usando `age_months`:
  - Puppy: 0–11
  - Young: 12–35
  - Adult: 36–83
  - Senior: 84+

---

### 7) Filtro “Urgent Need”

- **Dado** que activo “Urgent Need”
- **Cuando** se filtra
- **Entonces** se muestran animales que cumplen la regla derivada:
  - `created_at` más antiguo que 90 días **o**
  - `age_months` <= 6 (cachorros)
- **Y** la regla usa solo datos existentes

---

### 8) Ordenamiento

- **Dado** que selecciono un orden
- **Cuando** aplico el sort
- **Entonces** se ordena por:
  - Newest Arrivals → `created_at DESC`
  - Oldest Arrivals → `created_at ASC`
  - Urgent Need → regla derivada con prioridad

---

### 9) Paginación server-side

- **Dado** que hay más resultados que el page size
- **Cuando** cambio de página
- **Entonces** se consulta Supabase con `range()`
- **Y** el listado se actualiza correctamente

---

### 10) Botón “Details”

- **Dado** un animal en la card
- **Cuando** hago clic en “Details”
- **Entonces** navego a `/adopt/[id]`

---

### 11) Estados de loading

- **Dado** que se consulta Supabase
- **Cuando** se carga el catálogo
- **Entonces** se muestra un estado de loading
- **Y** al finalizar desaparece

---

### 12) Manejo de errores

- **Dado** que ocurre un error al consultar
- **Cuando** Supabase retorna error
- **Entonces** se muestra un mensaje traducido
- **Y** la UI no se rompe

---

### 13) Traducciones

- **Dado** que se implementa la UI
- **Cuando** se revisa el código
- **Entonces** todos los textos usan `useTranslations`
- **Y** existen traducciones en `src/messages/es/adopt.json` y `src/messages/en/adopt.json`

---

## Reglas técnicas

### Arquitectura
- Presentation solo consume UseCases vía IoC (no importa repositorios concretos).
- Domain no importa React/Next/MUI/Tailwind/Inversify/Supabase.
- Infrastructure contiene implementaciones y wiring IoC.
- Supabase solo vive en Infrastructure.

### Supabase / Queries
- Query base:
  - `SELECT * FROM animals WHERE status = 'available' AND is_published = true`
- Filtros:
  - `species` → `eq('species', value)`
  - `size` → `eq('size', value)`
  - `age_months` → rango según categoría
  - `search` → `or(name.ilike.%q%, breed.ilike.%q%)`
- Ordenamiento:
  - `created_at ASC/DESC`
  - “Urgent Need” → ordenar por `created_at ASC` y filtrar por regla derivada
- Paginación:
  - `range(from, to)` con `count: 'exact'`

### Urgent Need (regla derivada)
- No existe campo en BD.
- Se define como:
  - `created_at` <= hoy - 90 días **o**
  - `age_months` <= 6
- Badge “URGENT” se muestra si cumple la regla.

### Traducciones
- Usar `useTranslations('adopt')`.
- No hardcodear textos.

### Dependencias / Paquetes
- No agregar dependencias nuevas.

---

## Implementación sugerida

### Estructura de archivos sugerida:
```
src/app/[locale]/adopt/page.tsx

src/presentation/components/adopt/
├── AdoptCatalogPage.tsx
├── AdoptFilters.tsx
├── AdoptSearchBar.tsx
├── AdoptSortSelect.tsx
├── AdoptGrid.tsx
├── AdoptCard.tsx
└── AdoptPagination.tsx

src/domain/
├── models/
│   └── AdoptCatalogItem.ts
├── repositories/
│   └── IAnimalRepository.ts (extender con getAdoptCatalog)
└── usecases/
    └── adopt/
        └── GetAdoptCatalogUseCase.ts

src/infrastructure/
├── repositories/
│   └── AnimalRepository.ts (implementar getAdoptCatalog)
└── ioc/
    └── bindings actualizados

src/messages/
├── es/
│   └── adopt.json
└── en/
    └── adopt.json
```

---

## Validación

Comandos mínimos:
- `npm run dev`
- `npm run build`

Verificaciones:
- El catálogo se ve igual al diseño
- Filtros y búsqueda funcionan
- Paginación funciona
- Datos reales desde Supabase
- Traducciones completas

---

## Definición de Hecho

- [ ] Criterios de aceptación cumplidos
- [ ] `npm run dev` OK
- [ ] `npm run build` OK
- [ ] Catálogo público creado y funcional
- [ ] Filtros, búsqueda y ordenamiento funcionando
- [ ] Paginación server-side funcionando
- [ ] Datos de Supabase mostrados correctamente
- [ ] Traducciones incluidas (ES/EN)
- [ ] Sin violaciones de capas
- [ ] Sin cambios fuera del alcance
- Commit sugerido:
  `feat: add adopt catalog with filters and supabase data`

