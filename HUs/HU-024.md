# HU-024 — Agregar Animal a la Fundación

**Como** usuario de una fundación  
**Quiero** agregar un nuevo animal a mi fundación con todos sus detalles e imágenes  
**Para** publicarlo en el catálogo de adopción y gestionarlo desde el dashboard

---

## Dependencias

- HU-011 (Conexión a Supabase configurada)
- HU-013 (Estrategia de roles y protección de rutas definida)
- HU-014 (Formik y Yup configurados)
- HU-016 (Sistema de traducciones configurado)
- HU-018 (Layout del dashboard de fundaciones con sidebar) - **REQUERIDO**
- HU-022 (UI de gestión de animales implementada) - **REQUERIDO**
- HU-023 (Funcionalidad de gestión de animales con Supabase) - **REQUERIDO**

---

## Contexto / Notas

- Esta HU implementa la funcionalidad completa para **agregar un nuevo animal** a la fundación del usuario autenticado.
- Incluye UI del formulario, validaciones, creación en Supabase y subida de imágenes.
- El formulario debe seguir el diseño exacto de `docs/design/add_animals_screen.png` y `docs/design/add_animals_code.html`.
- Después de crear el animal, el usuario debe poder verlo en la lista de animales (HU-022/HU-023).
- El flujo completo:
  1. Usuario navega a `/foundations/animals/add` (o desde botón "+ Add New Animal")
  2. Completa el formulario con datos del animal
  3. Sube imágenes (mínimo 1, recomendado 3+)
  4. Guarda como borrador o publica directamente
  5. Se crea el animal en Supabase con `foundation_id` del usuario
  6. Se suben las imágenes a `animal_photos` con `sort_order`
  7. Se redirige a la lista de animales donde aparece el nuevo animal

Modelo de datos (según `docs/scripts/db.sql`):
- Tabla `animals`:
  - Campos requeridos: `foundation_id`, `name`, `species`, `sex`
  - Campos opcionales: `breed`, `age_months`, `size`, `description`, `cover_image_url`, `status`, `is_published`
  - `status` por defecto: `'available'`
  - `is_published` por defecto: `false`
- Tabla `animal_photos` (relación 1:N):
  - Campos: `animal_id`, `url`, `sort_order`
  - La primera imagen (sort_order = 0) puede usarse como `cover_image_url`

Reglas de negocio:
- El usuario debe estar autenticado y ser miembro de una fundación.
- `foundation_id` se obtiene automáticamente del usuario autenticado (vía `foundation_members`).
- Campos requeridos: `name`, `age`, `gender`, `description`, `status`.
- `age` se almacena como `age_months` en la BD (convertir de años/meses según unidad seleccionada).
- `species` debe ser una de: `dog`, `cat`, `bird`, `other`.
- `status` debe ser una de: `available`, `adopted`, `in_treatment`, `inactive`.
- `sex` debe ser: `male`, `female`, `unknown`.
- `size` debe ser: `small`, `medium`, `large`, `unknown`.
- Mínimo 1 imagen, máximo 10 imágenes por animal.
- Tamaño máximo de imagen: 5MB.
- Formatos permitidos: SVG, PNG, JPG, GIF.
- Si se publica (`is_published = true`), el animal aparece en el catálogo público.
- Si se guarda como borrador (`is_published = false`), solo es visible en el dashboard.

Mapeo de datos del formulario a BD:
- `name` → `animals.name`
- `breed` → `animals.breed` (opcional)
- `age` + `ageUnit` → `animals.age_months` (convertir: años * 12 o meses)
- `gender` → `animals.sex` (mapear: Male → male, Female → female)
- `size` → `animals.size` (mapear según opciones del select)
- `species` → `animals.species` (mapear según opciones del select)
- `description` → `animals.description`
- `status` → `animals.status` (mapear según opciones del select)
- `currentLocation` → No se almacena en BD (solo para referencia, puede ser campo futuro)
- `healthStatus` (checkboxes) → No se almacena en BD (puede ser campo futuro)
- `photos` → `animal_photos` (múltiples registros)
- Primera foto → `animals.cover_image_url` (opcional, puede ser la primera de `animal_photos`)

---

## Diseño (OBLIGATORIO)

Referencias:
- Diseño: `docs/design/add_animals_code.html`
- Imagen: `docs/design/add_animals_screen.png`
- Design System: `docs/design/system.md`
- Esquema BD: `docs/scripts/db.sql`

Estructura del formulario:
- **Breadcrumbs**: "Dashboard / My Animals / Add New"
- **Header de la página**:
  - Título: "Add a New Amigo"
  - Subtítulo: "Fill in the details below to add a new animal to the adoption catalog."
- **Sección 1: The Basics**
  - Animal Name* (text input)
  - Breed (text input, opcional, con hint "Mixed if unknown")
  - Age* (number input) + Unit (dropdown: Years/Months)
  - Gender* (dropdown: Select gender / Male / Female)
  - Size (dropdown: Select size / Small (0-10kg) / Medium (11-25kg) / Large (26-40kg) / Giant (41kg+))
  - Current Location (text input con icono de ubicación, opcional)
- **Sección 2: Media Gallery**
  - Título: "Media Gallery"
  - Subtítulo: "Good photos increase adoption chances! Try to upload at least 3."
  - Área de upload (drag & drop o click)
  - Grid de previews de imágenes (2 columnas en móvil, 4 en desktop)
  - Botón de eliminar en cada preview (hover)
  - Límite: MAX. 5MB por imagen
  - Formatos: SVG, PNG, JPG, GIF
- **Sección 3: Their Story**
  - Description* (textarea, mínimo 1000 caracteres, contador "0/1000 characters")
  - Status* (dropdown: Available for Adoption / Sponsorship Only / Foster Care Needed / Adoption Pending)
  - Health Status (checkboxes: Vaccinated, Spayed/Neutered, Wormed) - opcional, no se guarda en BD
- **Footer / Actions**:
  - Botón "Save Draft" (secundario)
  - Botón "Publish Profile" (primario, con icono)

Reglas:
- Usar tokens del Design System.
- El formulario debe ser responsive.
- Validaciones en tiempo real (onBlur) y al enviar.
- Mostrar mensajes de error claros.
- Estados de loading durante el envío.
- Feedback visual al subir imágenes.

---

## Alcance

Incluye:
- Crear página `/foundations/animals/add` (dentro del área de fundaciones)
- Implementar formulario completo con todas las secciones del diseño
- Validaciones con Formik y Yup para todos los campos
- Manejo de subida de imágenes (múltiples archivos)
- Preview de imágenes antes de subir
- Eliminar imágenes del preview
- Crear animal en Supabase (`animals` table)
- Subir imágenes a Supabase Storage (o URLs si ya están en storage)
- Crear registros en `animal_photos` con `sort_order`
- Establecer `cover_image_url` (primera imagen)
- Obtener `foundation_id` del usuario autenticado
- Opciones de guardar como borrador o publicar
- Redirección a `/foundations/animals` después de crear
- Mostrar mensaje de éxito
- Manejo de errores y mensajes traducidos
- Estados de loading durante operaciones
- Validación de tamaño y formato de imágenes
- Contador de caracteres para descripción
- Traducciones completas (español e inglés)
- Navegación desde botón "+ Add New Animal" en la lista

No incluye:
- Editar animales existentes (HU futura)
- Eliminar animales (HU futura)
- Upload real a Supabase Storage (por ahora solo URLs, puede ser HU futura)
- Gestión avanzada de imágenes (redimensionar, optimizar, etc.)
- Validación de permisos granulares (solo membership básico)
- Tests automatizados (si luego se define estrategia de tests, se hará en HU futura)
- Funcionalidad de "Current Location" (solo UI, no se guarda)
- Funcionalidad de "Health Status" (solo UI, no se guarda en BD)

---

## Criterios de aceptación (Given / When / Then)

### 1) Página de agregar animal creada

- **Dado** que necesito agregar un animal a mi fundación
- **Cuando** navego a la ruta `/foundations/animals/add`
- **Entonces** veo el formulario completo
- **Y** la página usa el layout del dashboard de fundaciones (HU-018)
- **Y** la página se carga sin errores
- **Y** el sidebar muestra "Animals" como activo

---

### 2) Navegación desde lista de animales

- **Dado** que estoy en la página de gestión de animales (HU-022)
- **Cuando** hago clic en el botón "+ Add New Animal"
- **Entonces** navego a `/foundations/animals/add`
- **Y** el formulario se muestra correctamente

---

### 3) Sección "The Basics" implementada

- **Dado** que estoy en el formulario de agregar animal
- **Cuando** observo la sección "The Basics"
- **Entonces** veo todos los campos:
  - Animal Name* (requerido)
  - Breed (opcional)
  - Age* + Unit (requerido)
  - Gender* (requerido)
  - Size (opcional)
  - Current Location (opcional)
- **Y** los campos tienen los placeholders y labels correctos
- **Y** los campos requeridos están marcados con asterisco rojo

---

### 4) Validaciones de "The Basics"

- **Dado** que estoy en el formulario de agregar animal
- **Cuando** intento enviar sin completar campos requeridos
- **Entonces** se muestran mensajes de error:
  - "Animal Name is required"
  - "Age is required"
  - "Gender is required"
- **Y** los campos con error muestran borde rojo
- **Y** los mensajes de error están traducidos

---

### 5) Sección "Media Gallery" implementada

- **Dado** que estoy en el formulario de agregar animal
- **Cuando** observo la sección "Media Gallery"
- **Entonces** veo:
  - Área de upload con drag & drop
  - Texto: "Click to upload or drag and drop"
  - Texto: "SVG, PNG, JPG or GIF (MAX. 5MB)"
  - Grid de previews (vacío inicialmente)
- **Y** puedo hacer clic o arrastrar archivos para subir

---

### 6) Subida de imágenes funcional

- **Dado** que estoy en el formulario de agregar animal
- **Cuando** subo una o más imágenes
- **Entonces** las imágenes aparecen en el grid de previews
- **Y** puedo eliminar imágenes del preview
- **Y** se valida el tamaño máximo (5MB)
- **Y** se valida el formato (SVG, PNG, JPG, GIF)
- **Y** si una imagen excede el tamaño, se muestra error
- **Y** si el formato no es válido, se muestra error
- **Y** mínimo 1 imagen es requerida para publicar

---

### 7) Sección "Their Story" implementada

- **Dado** que estoy en el formulario de agregar animal
- **Cuando** observo la sección "Their Story"
- **Entonces** veo:
  - Description* (textarea con contador de caracteres)
  - Status* (dropdown)
  - Health Status (checkboxes opcionales)
- **Y** el contador muestra "0/1000 characters"
- **Y** el contador se actualiza al escribir

---

### 8) Validaciones de "Their Story"

- **Dado** que estoy en el formulario de agregar animal
- **Cuando** intento enviar sin completar campos requeridos
- **Entonces** se muestran mensajes de error:
  - "Description is required" (si está vacío)
  - "Description must be at least 100 characters" (si es muy corto)
  - "Status is required"
- **Y** los campos con error muestran borde rojo

---

### 9) Crear animal en Supabase

- **Dado** que completo el formulario correctamente
- **Cuando** hago clic en "Publish Profile" o "Save Draft"
- **Entonces** se crea el animal en la tabla `animals` de Supabase
- **Y** el `foundation_id` se obtiene automáticamente del usuario autenticado
- **Y** los campos se mapean correctamente a la BD
- **Y** `is_published` es `true` si se publica, `false` si se guarda como borrador
- **Y** `status` se guarda correctamente según la selección

---

### 10) Subir imágenes a animal_photos

- **Dado** que completo el formulario con imágenes
- **Cuando** se crea el animal
- **Entonces** se crean registros en `animal_photos` para cada imagen
- **Y** cada registro tiene `animal_id`, `url` y `sort_order` correctos
- **Y** la primera imagen (sort_order = 0) se establece como `cover_image_url`
- **Y** las imágenes se ordenan según el orden de subida

---

### 11) Conversión de edad a meses

- **Dado** que ingreso la edad del animal
- **Cuando** selecciono la unidad (Years o Months)
- **Entonces** la edad se convierte correctamente a meses:
  - Si es "Years": `age_months = age * 12`
  - Si es "Months": `age_months = age`
- **Y** se guarda correctamente en `animals.age_months`

---

### 12) Mapeo de valores del formulario a BD

- **Dado** que completo el formulario
- **Cuando** se crea el animal
- **Entonces** los valores se mapean correctamente:
  - `gender: "Male"` → `sex: "male"`
  - `gender: "Female"` → `sex: "female"`
  - `size: "Small (0-10kg)"` → `size: "small"`
  - `size: "Medium (11-25kg)"` → `size: "medium"`
  - `size: "Large (26-40kg)"` → `size: "large"`
  - `size: "Giant (41kg+)"` → `size: "large"` (o crear nuevo valor si es necesario)
  - `species` según opciones del select
  - `status` según opciones del select

---

### 13) Estados de loading

- **Dado** que envío el formulario
- **Cuando** se está creando el animal
- **Entonces** se muestra un estado de loading
- **Y** los botones están deshabilitados
- **Y** los campos están deshabilitados
- **Y** se muestra un spinner o indicador de carga

---

### 14) Manejo de errores

- **Dado** que ocurre un error al crear el animal
- **Cuando** Supabase retorna error (sin permisos, conectividad, etc.)
- **Entonces** se muestra un mensaje de error traducido
- **Y** la UI no se rompe
- **Y** el usuario puede intentar nuevamente
- **Y** los datos del formulario se mantienen (no se pierden)

---

### 15) Redirección después de crear

- **Dado** que se crea el animal exitosamente
- **Cuando** se completa la operación
- **Entonces** se redirige a `/foundations/animals`
- **Y** se muestra un mensaje de éxito (toast, snackbar, etc.)
- **Y** el nuevo animal aparece en la lista
- **Y** la lista se actualiza automáticamente

---

### 16) Ver animal creado en la lista

- **Dado** que creé un animal exitosamente
- **Cuando** navego a la lista de animales
- **Entonces** el nuevo animal aparece en la tabla
- **Y** los datos se muestran correctamente (nombre, especie, estado, etc.)
- **Y** la imagen de perfil se muestra correctamente
- **Y** el ID se formatea como #AG-XXXX

---

### 17) Guardar como borrador vs publicar

- **Dado** que completo el formulario
- **Cuando** hago clic en "Save Draft"
- **Entonces** el animal se crea con `is_published = false`
- **Y** cuando hago clic en "Publish Profile"
- **Entonces** el animal se crea con `is_published = true`
- **Y** ambos casos funcionan correctamente

---

### 18) Traducciones implementadas

- **Dado** que se implementa el formulario
- **Cuando** se revisa el código
- **Entonces** todos los textos usan `useTranslations` de `next-intl`
- **Y** existen traducciones en `src/messages/es/animals.json` y `src/messages/en/animals.json`
- **Y** los mensajes de error y validación están traducidos
- **Y** no hay textos hardcodeados

---

### 19) Reglas de arquitectura cumplidas

- **Dado** que se implementa la funcionalidad
- **Cuando** se revisan imports y capas
- **Entonces** Domain no importa Supabase/React/Next/MUI/Tailwind/Inversify/Formik/Yup
- **Y** Presentation consume UseCases vía IoC
- **Y** Infrastructure contiene las implementaciones de repositorios y el wiring
- **Y** Supabase solo vive en Infrastructure

---

## Reglas técnicas

### Arquitectura
- Presentation solo consume UseCases vía IoC (no importa repositorios concretos).
- Domain no importa React/Next/MUI/Tailwind/Inversify/Supabase/Formik/Yup.
- Infrastructure contiene implementaciones y wiring IoC.
- **Supabase solo vive en Infrastructure**: servicios y repositorios.

### Flujo de creación de animal

1. Usuario navega a `/foundations/animals/add` (Presentation)
2. `AddAnimalPage` renderiza `AddAnimalForm` con Formik (Presentation)
3. Usuario completa formulario y sube imágenes (Presentation)
4. Usuario hace clic en "Publish" o "Save Draft" (Presentation)
5. `AddAnimalForm` llama a `CreateAnimalUseCase` (Presentation → Domain)
6. UseCase obtiene `foundation_id` del usuario (vía `GetSessionUseCase` o `FoundationMembershipRepository`)
7. UseCase llama a `AnimalRepository.createAnimal()` (Domain → Infrastructure)
8. `AnimalRepository.createAnimal()` crea registro en `animals` (Infrastructure → Supabase)
9. `AnimalRepository.createAnimalPhotos()` crea registros en `animal_photos` (Infrastructure → Supabase)
10. UseCase retorna animal creado
11. Presentation redirige a `/foundations/animals` con mensaje de éxito

### Obtener foundation_id del usuario

- Usar `supabaseClient.auth.getUser()` para obtener `user.id`.
- Query: `SELECT foundation_id FROM foundation_members WHERE user_id = :userId LIMIT 1`
- Si no existe membership, manejar como error (usuario sin fundación).
- Puede reutilizar lógica de `FoundationProfileRepository.getFoundationIdForUser()`.

### Crear animal en Supabase

- Insertar en `animals`:
  ```sql
  INSERT INTO animals (
    foundation_id, name, species, breed, sex, age_months, 
    size, status, description, cover_image_url, is_published
  ) VALUES (...)
  ```
- Retornar el `id` generado (identity).
- Manejar errores de validación (constraints de BD).

### Subir imágenes

- Por ahora, asumir que las imágenes ya están en Supabase Storage o son URLs públicas.
- Si se implementa upload real:
  - Subir a Supabase Storage bucket (ej: `animal-photos`)
  - Obtener URL pública de cada imagen
  - Crear registros en `animal_photos` con las URLs
- Si solo son URLs (mock o ya subidas):
  - Validar que sean URLs válidas
  - Crear registros en `animal_photos` directamente
- Ordenar imágenes por orden de subida (`sort_order`: 0, 1, 2, ...).
- Primera imagen (`sort_order = 0`) → establecer como `cover_image_url`.

### Validaciones con Formik y Yup

- Crear esquema de validación con Yup.
- Validar campos requeridos: `name`, `age`, `gender`, `description`, `status`.
- Validar formato y tamaño de imágenes.
- Validar longitud mínima de descripción (100 caracteres).
- Validar edad (número positivo).
- Mensajes de error traducidos usando `next-intl`.

### Mapeo de valores

- `gender`: "Male" → "male", "Female" → "female"
- `size`: "Small (0-10kg)" → "small", "Medium (11-25kg)" → "medium", "Large (26-40kg)" → "large", "Giant (41kg+)" → "large"
- `species`: según opciones del select (dog, cat, bird, other)
- `status`: según opciones del select (available, adopted, in_treatment, inactive)
- `age`: convertir según unidad (Years → meses, Months → meses)

### Manejo de errores

- Los errores de Supabase deben traducirse a mensajes legibles en español e inglés.
- Usar `PostgrestError` de Supabase para identificar tipos de error.
- Los mensajes de error deben estar en los archivos de traducción.
- Mostrar errores en la UI sin romper el layout.

### Traducciones
- **TODOS los mensajes visibles en la UI deben estar traducidos** (español e inglés).
- Usar el sistema de traducciones configurado en HU-016 (`next-intl`).
- Agregar traducciones en:
  - `src/messages/es/animals.json` (español)
  - `src/messages/en/animals.json` (inglés)
- Incluir traducciones para:
  - Labels de campos
  - Placeholders
  - Mensajes de error y validación
  - Mensajes de éxito
  - Opciones de selects
  - Textos de ayuda
- Usar `useTranslations('animals')` hook de `next-intl` para acceder a traducciones.

### Dependencias / Paquetes
- No agregar dependencias nuevas salvo que esta HU lo indique explícitamente.
- Formik y Yup ya están instalados (HU-014).
- Supabase ya está configurado (HU-011).
- Si aparece error 403/conectividad:
  1) Detenerse
  2) Pedir dominios requeridos
  3) Explicar por qué se requieren
  4) No continuar

---

## Implementación sugerida

### Estructura de archivos sugerida:

```
src/app/[locale]/foundations/animals/add/
└── page.tsx                        # Página de agregar animal

src/presentation/components/animals/
├── AddAnimalForm.tsx              # Formulario principal con Formik
├── AnimalFormBasics.tsx            # Sección "The Basics"
├── AnimalFormMedia.tsx             # Sección "Media Gallery"
├── AnimalFormStory.tsx             # Sección "Their Story"
├── ImageUploadArea.tsx             # Componente de upload de imágenes
├── ImagePreviewGrid.tsx            # Grid de previews de imágenes
└── addAnimalValidation.ts          # Schema de validación con Yup

src/domain/
├── models/
│   └── CreateAnimalInput.ts        # Input DTO para crear animal
├── repositories/
│   └── IAnimalRepository.ts         # Agregar método: createAnimal
└── usecases/
    └── animals/
        └── CreateAnimalUseCase.ts   # UseCase para crear animal

src/infrastructure/
├── repositories/
│   └── AnimalRepository.ts          # Implementar createAnimal, createAnimalPhotos
└── ioc/
    └── ...                          # Agregar bindings de CreateAnimalUseCase

src/messages/
├── es/
│   └── animals.json                 # Traducciones en español (extender)
└── en/
    └── animals.json                  # Traducciones en inglés (extender)
```

### Flujo de implementación:

1. **Extender IAnimalRepository**:
   ```typescript
   export interface CreateAnimalParams {
     foundationId: string;
     name: string;
     species: AnimalManagementSpecies;
     breed?: string | null;
     sex: AnimalManagementSex;
     ageMonths: number | null;
     size: AnimalManagementSize;
     status: AnimalManagementStatus;
     description: string;
     coverImageUrl?: string | null;
     isPublished: boolean;
   }
   
   export interface CreateAnimalPhotoParams {
     animalId: number;
     url: string;
     sortOrder: number;
   }
   
   export interface IAnimalRepository {
     getHomeAnimals(): Promise<HomeAnimals>;
     getAnimals(params: GetAnimalsParams): Promise<GetAnimalsResult>;
     createAnimal(params: CreateAnimalParams): Promise<AnimalManagement>; // Nuevo
     createAnimalPhotos(params: CreateAnimalPhotoParams[]): Promise<void>; // Nuevo
   }
   ```

2. **Implementar createAnimal en AnimalRepository**:
   - Insertar en `animals` con todos los campos
   - Retornar el animal creado (mapeado a `AnimalManagement`)
   - Manejar errores y traducirlos

3. **Implementar createAnimalPhotos en AnimalRepository**:
   - Insertar múltiples registros en `animal_photos`
   - Usar transacción o batch insert si es posible
   - Manejar errores

4. **Crear CreateAnimalUseCase**:
   ```typescript
   export interface CreateAnimalInput {
     name: string;
     species: AnimalManagementSpecies;
     breed?: string | null;
     sex: AnimalManagementSex;
     age: number;
     ageUnit: 'years' | 'months';
     size: AnimalManagementSize;
     status: AnimalManagementStatus;
     description: string;
     photos: string[]; // URLs de imágenes
     isPublished: boolean;
   }
   
   export class CreateAnimalUseCase {
     constructor(
       private readonly animalRepository: IAnimalRepository,
       private readonly foundationMembershipRepository: IFoundationMembershipRepository // Para obtener foundation_id
     ) {}
     
     async execute(input: CreateAnimalInput): Promise<AnimalManagement> {
       // 1. Obtener usuario autenticado
       // 2. Obtener foundation_id del usuario
       // 3. Convertir edad a meses
       // 4. Determinar cover_image_url (primera foto)
       // 5. Crear animal en BD
       // 6. Crear registros de fotos en BD
       // 7. Retornar animal creado
     }
   }
   ```

5. **Crear AddAnimalForm con Formik**:
   - Usar `useFormik` o `<Formik>`
   - Definir valores iniciales
   - Conectar con esquema de validación Yup
   - Manejar submit (llamar a `CreateAnimalUseCase`)
   - Manejar estados de loading y error
   - Redirigir después de éxito

6. **Crear componentes de secciones**:
   - `AnimalFormBasics`: campos básicos
   - `AnimalFormMedia`: upload y preview de imágenes
   - `AnimalFormStory`: descripción y estado

7. **Crear componente de upload de imágenes**:
   - Drag & drop
   - Click para seleccionar
   - Validación de formato y tamaño
   - Preview de imágenes
   - Eliminar imágenes

8. **Agregar traducciones**:
   - Extender `src/messages/es/animals.json` y `src/messages/en/animals.json`
   - Agregar todas las keys necesarias

9. **Conectar navegación**:
   - Agregar botón "+ Add New Animal" en `AnimalsManagementPage` que navegue a `/foundations/animals/add`

### Schema de validación sugerido:

```typescript
import * as Yup from 'yup';
import type { UseTranslationsType } from 'next-intl';

export const createAddAnimalValidationSchema = (t: UseTranslationsType<'animals'>) =>
  Yup.object().shape({
    name: Yup.string()
      .trim()
      .required(t('form.validation.nameRequired'))
      .min(2, t('form.validation.nameMin')),
    breed: Yup.string().trim().optional().nullable(),
    age: Yup.number()
      .required(t('form.validation.ageRequired'))
      .min(0, t('form.validation.ageMin'))
      .integer(t('form.validation.ageInteger')),
    ageUnit: Yup.string()
      .oneOf(['years', 'months'], t('form.validation.ageUnitInvalid'))
      .required(),
    gender: Yup.string()
      .oneOf(['male', 'female'], t('form.validation.genderRequired'))
      .required(t('form.validation.genderRequired')),
    size: Yup.string()
      .oneOf(['small', 'medium', 'large', 'unknown'], t('form.validation.sizeInvalid'))
      .optional()
      .nullable(),
    species: Yup.string()
      .oneOf(['dog', 'cat', 'bird', 'other'], t('form.validation.speciesRequired'))
      .required(t('form.validation.speciesRequired')),
    description: Yup.string()
      .trim()
      .required(t('form.validation.descriptionRequired'))
      .min(100, t('form.validation.descriptionMin')),
    status: Yup.string()
      .oneOf(['available', 'adopted', 'in_treatment', 'inactive'], t('form.validation.statusRequired'))
      .required(t('form.validation.statusRequired')),
    photos: Yup.array()
      .of(Yup.string().url(t('form.validation.photoUrlInvalid')))
      .min(1, t('form.validation.photosMin'))
      .max(10, t('form.validation.photosMax')),
    currentLocation: Yup.string().trim().optional().nullable(),
    healthStatus: Yup.object({
      vaccinated: Yup.boolean().optional(),
      spayedNeutered: Yup.boolean().optional(),
      wormed: Yup.boolean().optional(),
    }).optional(),
  });
```

### Estructura de traducciones sugerida:

**src/messages/es/animals.json** (extender):
```json
{
  "form": {
    "title": "Agregar un Nuevo Amigo",
    "subtitle": "Completa los detalles a continuación para agregar un nuevo animal al catálogo de adopción.",
    "sections": {
      "basics": "Información Básica",
      "media": "Galería de Medios",
      "story": "Su Historia"
    },
    "fields": {
      "name": {
        "label": "Nombre del Animal",
        "placeholder": "ej. Buddy"
      },
      "breed": {
        "label": "Raza",
        "hint": "(Mixta si se desconoce)"
      },
      "age": {
        "label": "Edad",
        "placeholder": "0"
      },
      "ageUnit": {
        "label": "Unidad",
        "years": "Años",
        "months": "Meses"
      },
      "gender": {
        "label": "Género",
        "placeholder": "Seleccionar género",
        "male": "Macho",
        "female": "Hembra"
      },
      "size": {
        "label": "Tamaño",
        "placeholder": "Seleccionar tamaño",
        "small": "Pequeño (0-10kg)",
        "medium": "Mediano (11-25kg)",
        "large": "Grande (26-40kg)",
        "giant": "Gigante (41kg+)"
      },
      "currentLocation": {
        "label": "Ubicación Actual",
        "placeholder": "Ciudad, Nombre del Refugio"
      },
      "description": {
        "label": "Descripción",
        "placeholder": "Cuéntanos sobre su personalidad, historia y qué tipo de hogar necesita...",
        "characters": "{count}/1000 caracteres"
      },
      "status": {
        "label": "Estado",
        "available": "Disponible para Adopción",
        "sponsorship": "Solo Apadrinamiento",
        "foster": "Necesita Hogar Temporal",
        "pending": "Adopción Pendiente"
      },
      "healthStatus": {
        "label": "Estado de Salud",
        "vaccinated": "Vacunado",
        "spayedNeutered": "Esterilizado/Castrado",
        "wormed": "Desparasitado"
      },
      "photos": {
        "label": "Fotos",
        "uploadText": "Haz clic para subir o arrastra y suelta",
        "uploadHint": "SVG, PNG, JPG o GIF (MÁX. 5MB)",
        "minPhotos": "¡Las buenas fotos aumentan las posibilidades de adopción! Intenta subir al menos 3."
      }
    },
    "actions": {
      "saveDraft": "Guardar Borrador",
      "publish": "Publicar Perfil"
    },
    "validation": {
      "nameRequired": "El nombre del animal es requerido",
      "nameMin": "El nombre debe tener al menos 2 caracteres",
      "ageRequired": "La edad es requerida",
      "ageMin": "La edad debe ser mayor o igual a 0",
      "ageInteger": "La edad debe ser un número entero",
      "ageUnitInvalid": "La unidad de edad no es válida",
      "genderRequired": "El género es requerido",
      "sizeInvalid": "El tamaño no es válido",
      "speciesRequired": "La especie es requerida",
      "descriptionRequired": "La descripción es requerida",
      "descriptionMin": "La descripción debe tener al menos 100 caracteres",
      "statusRequired": "El estado es requerido",
      "photoUrlInvalid": "La URL de la foto no es válida",
      "photosMin": "Debes subir al menos 1 foto",
      "photosMax": "No puedes subir más de 10 fotos"
    },
    "success": {
      "created": "Animal creado exitosamente",
      "published": "Animal publicado exitosamente"
    },
    "errors": {
      "createFailed": "Error al crear el animal",
      "uploadFailed": "Error al subir las imágenes",
      "unauthorized": "No tienes permisos para crear animales"
    }
  }
}
```

**src/messages/en/animals.json** (extender de manera similar con traducciones en inglés).

---

## Validación

Comandos mínimos:
- `npm run dev` (verificar que el formulario funciona)
- `npm run build` (verificar que no hay errores de compilación)

Verificaciones manuales:
- [ ] El formulario se ve igual al diseño de referencia
- [ ] Todas las validaciones funcionan correctamente
- [ ] La subida de imágenes funciona
- [ ] El animal se crea correctamente en Supabase
- [ ] Las imágenes se guardan correctamente en `animal_photos`
- [ ] La redirección funciona después de crear
- [ ] El animal aparece en la lista
- [ ] Los mensajes de error están traducidos
- [ ] Los estados de loading funcionan
- [ ] El formulario es responsive

---

## Definición de Hecho

- [ ] Criterios de aceptación cumplidos
- [ ] `npm run dev` OK
- [ ] `npm run build` OK
- [ ] Página de agregar animal creada y accesible
- [ ] Formulario completo implementado con todas las secciones
- [ ] Validaciones con Formik y Yup funcionando
- [ ] Subida de imágenes funcional
- [ ] Método `createAnimal` implementado en `IAnimalRepository` y `AnimalRepository`
- [ ] Método `createAnimalPhotos` implementado
- [ ] `CreateAnimalUseCase` creado y funcional
- [ ] `AddAnimalForm` conectado con `CreateAnimalUseCase`
- [ ] Animal se crea correctamente en Supabase
- [ ] Imágenes se guardan correctamente en `animal_photos`
- [ ] Redirección funciona después de crear
- [ ] Animal aparece en la lista de animales
- [ ] Manejo de errores implementado y traducido
- [ ] Estados de loading implementados
- [ ] Mapeo de datos correcto (edad, género, tamaño, especie, estado)
- [ ] **Traducciones incluidas**:
  - [ ] Textos agregados en `src/messages/es/animals.json`
  - [ ] Textos agregados en `src/messages/en/animals.json`
  - [ ] Componentes usan `useTranslations` (no textos hardcodeados)
  - [ ] Keys consistentes entre idiomas
- [ ] Navegación desde botón "+ Add New Animal" funciona
- [ ] Sin violaciones de capas
- [ ] Sin cambios fuera del alcance
- Commit sugerido:
  `feat: add create animal form with Supabase integration`

