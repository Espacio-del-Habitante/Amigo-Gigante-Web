# HU-028 — Tienda Solidaria (Catálogo de Productos con Supabase)

**Como** usuario externo  
**Quiero** acceder a la tienda solidaria  
**Para** comprar productos de fundaciones y apoyar su labor

---

## Dependencias

- HU-001 (Next.js App Router)
- HU-007 (Tailwind configurado)
- HU-010 (Atomic Design - componentes reutilizables)
- HU-011 (Conexión a Supabase configurada)
- HU-016 (Sistema de traducciones configurado)

---

## Contexto / Notas

- Esta HU implementa la **Tienda Solidaria** como catálogo público de productos.
- El diseño está en `docs/design/shop_screen.png` y `docs/design/shop_code.html`.
- La ruta debe ser `/shop` (o `app/[locale]/shop/page.tsx`).
- La data proviene de Supabase usando el modelo `products` y `foundations` de `docs/scripts/db.sql`.
- Solo se muestran productos **publicados**:
  - `is_published = true`
- El catálogo se agrupa por fundación (secciones por fundación).
- No existen categorías ni stock en la BD → no se inventan datos.

Modelo de datos disponible (según `docs/scripts/db.sql`):
- Tabla `products`:
  - `id`, `foundation_id`, `name`, `description`, `price`, `image_url`, `is_published`, `created_at`
- Tabla `foundations`:
  - `id`, `name`, `logo_url`, `city`, `country`

---

## Diseño (OBLIGATORIO)

Referencias:
- Diseño: `docs/design/shop_code.html`
- Imagen: `docs/design/shop_screen.png`
- Design System: `docs/design/system.md`
- Esquema BD: `docs/scripts/db.sql`

Estructura de la página:
- **Navbar** (con opción “Tienda” activa)
- **Hero**:
  - Título: “Tienda Solidaria”
  - Subtítulo descriptivo
  - Barra de búsqueda + select de fundaciones + botón de buscar
- **Secciones por fundación**:
  - Encabezado con nombre y ubicación
  - Link “Ver todo”
  - Grid de cards de productos (4 columnas desktop)
- **Card de donación** (estática, diseño):
  - “Dona un Bulto” (UI, sin funcionalidad real)
- **Sección CTA**: “¿Tienes una fundación?”
- **Footer** público

Reglas:
- Respetar jerarquía visual del diseño.
- Usar tokens del Design System.
- Layout responsive.
- El catálogo debe parecer al diseño (sombras, bordes, badges).

---

## Alcance

Incluye:
- Crear página `/shop`
- Implementar UI completa según diseño
- Traer productos publicados desde Supabase
- Traer información de fundaciones desde Supabase
- Agrupar productos por fundación
- Búsqueda por nombre y descripción del producto
- Filtro por fundación (select)
- Paginación (si hay muchos productos)
- Mostrar precio con formato moneda
- Mostrar imagen del producto (`image_url`)
- Estados de loading y error
- Traducciones completas (ES/EN)

No incluye:
- Carrito de compras real
- Flujo de pago
- Stock o inventario (no existe en BD)
- Favoritos reales
- Categorías (no existe en BD)
- Tests automatizados

---

## Criterios de aceptación (Given / When / Then)

### 1) Ruta de tienda creada

- **Dado** que estoy en el sitio
- **Cuando** hago clic en “Tienda” en el navbar
- **Entonces** navego a `/shop`
- **Y** veo la tienda solidaria

---

### 2) Se muestran productos publicados

- **Dado** productos con `is_published = true`
- **Cuando** carga la tienda
- **Entonces** se muestran solo productos publicados
- **Y** los no publicados no aparecen

---

### 3) Agrupación por fundación

- **Dado** productos de varias fundaciones
- **Cuando** se renderiza el catálogo
- **Entonces** se agrupa por fundación
- **Y** cada sección muestra el nombre y ubicación de la fundación

---

### 4) Búsqueda funcional

- **Dado** que escribo un término en el buscador
- **Cuando** busco por nombre o descripción
- **Entonces** se filtran productos por `name` o `description`
- **Y** la búsqueda es case-insensitive

---

### 5) Filtro por fundación

- **Dado** el select de fundaciones
- **Cuando** elijo una fundación
- **Entonces** se muestran productos solo de esa fundación
- **Y** el título de la sección coincide con la fundación seleccionada

---

### 6) Botón “Ver todo”

- **Dado** una sección de fundación
- **Cuando** hago clic en “Ver todo”
- **Entonces** se aplica filtro por esa fundación
- **Y** se muestran sus productos

---

### 7) Formato de precio

- **Dado** un producto con `price`
- **Cuando** se renderiza la card
- **Entonces** el precio se muestra formateado (ej: `$85.000`)

---

### 8) Estados de loading

- **Dado** que se consulta Supabase
- **Cuando** carga la tienda
- **Entonces** se muestra un estado de loading
- **Y** desaparece al finalizar

---

### 9) Manejo de errores

- **Dado** que ocurre un error al consultar
- **Cuando** Supabase retorna error
- **Entonces** se muestra un mensaje traducido
- **Y** la UI no se rompe

---

### 10) Traducciones

- **Dado** que se implementa la UI
- **Cuando** se revisa el código
- **Entonces** todos los textos usan `useTranslations`
- **Y** existen traducciones en `src/messages/es/shop.json` y `src/messages/en/shop.json`

---

## Reglas técnicas

### Arquitectura
- Presentation solo consume UseCases vía IoC.
- Domain no importa React/Next/MUI/Tailwind/Inversify/Supabase.
- Infrastructure contiene implementaciones y wiring IoC.
- Supabase solo vive en Infrastructure.

### Supabase / Queries
- Productos publicados:
  - `SELECT * FROM products WHERE is_published = true`
- Filtro por fundación:
  - `eq('foundation_id', value)`
- Búsqueda:
  - `or(name.ilike.%q%, description.ilike.%q%)`
- Orden:
  - `created_at DESC` (por defecto)
- Paginación:
  - `range(from, to)` con `count: 'exact'`
- Fundaciones:
  - `SELECT id, name, city, country, logo_url FROM foundations`

### Traducciones
- Usar `useTranslations('shop')`.
- No hardcodear textos.

### Dependencias / Paquetes
- No agregar dependencias nuevas.

---

## Implementación sugerida

### Estructura de archivos sugerida:
```
src/app/[locale]/shop/page.tsx

src/presentation/components/shop/
├── ShopPage.tsx
├── ShopHero.tsx
├── ShopSearchBar.tsx
├── ShopFoundationSection.tsx
├── ShopProductCard.tsx
└── ShopPagination.tsx

src/domain/
├── models/
│   └── ShopProduct.ts
├── repositories/
│   ├── IProductRepository.ts (extender con getShopProducts)
│   └── IFoundationRepository.ts (extender con getFoundationsList)
└── usecases/
    └── shop/
        └── GetShopCatalogUseCase.ts

src/infrastructure/
├── repositories/
│   ├── ProductRepository.ts (implementar getShopProducts)
│   └── FoundationRepository.ts (implementar getFoundationsList)
└── ioc/
    └── bindings actualizados

src/messages/
├── es/
│   └── shop.json
└── en/
    └── shop.json
```

---

## Validación

Comandos mínimos:
- `npm run dev`
- `npm run build`

Verificaciones:
- La tienda se ve igual al diseño
- Productos reales desde Supabase
- Filtro y búsqueda funcionan
- Agrupación por fundación correcta
- Traducciones completas

---

## Definición de Hecho

- [ ] Criterios de aceptación cumplidos
- [ ] `npm run dev` OK
- [ ] `npm run build` OK
- [ ] Página de tienda creada y funcional
- [ ] Productos publicados desde Supabase
- [ ] Filtro por fundación y búsqueda funcionando
- [ ] Agrupación por fundación correcta
- [ ] Traducciones incluidas (ES/EN)
- [ ] Sin violaciones de capas
- [ ] Sin cambios fuera del alcance
- Commit sugerido:
  `feat: add shop catalog with supabase products`

