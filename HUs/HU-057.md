# HU-057 — Home: Animales y Fundaciones Destacadas con Datos Reales

**Como** visitante de la plataforma  
**Quiero** ver animales destacados (más antiguos) y fundaciones destacadas (con más animales) en la página de inicio  
**Para** facilitar la adopción de animales que llevan más tiempo esperando y conocer las fundaciones más activas

---

## Dependencias

- Requiere: HU-006 (Home MVP con UI)
- Requiere: HU-011 (Conexión a Supabase configurada)
- Requiere: HU-013 (Estrategia de roles y protección de rutas)
- Requiere: Tablas `animals` y `foundations` creadas en `db.sql`

---

## Contexto / Notas

- Esta HU reemplaza los datos mock del home con datos reales de Supabase
- Los animales destacados serán los más antiguos (fecha de creación) para priorizar su adopción
- Las fundaciones destacadas serán las que tengan más animales publicados
- Se debe mantener la estructura visual existente del home
- Los datos deben ser públicos (no requieren autenticación)

---

## Diseño

Referencias:
- Diseño: `docs/design/home_screen.png`
- Código HTML: `docs/design/code_home_screen.html`
- Design System: `docs/design/system.md`

Reglas:
- Respetar jerarquía visual del diseño existente
- No cambiar la estructura de las secciones, solo el contenido dinámico
- Mantener los mismos componentes visuales (cards, secciones, etc.)

---

## Alcance

Incluye:
- Modificar `AnimalRepository.getHomeAnimals()` para traer datos reales de Supabase
- Crear nuevo método `FoundationRepository.getFeaturedFoundations()` para fundaciones destacadas
- Crear UseCase `GetFeaturedFoundationsUseCase` para obtener fundaciones con más animales
- Modificar `GetHomeAnimalsUseCase` para traer animales más antiguos primero
- Actualizar página home para consumir datos reales
- Agregar traducciones necesarias

No incluye:
- Cambios en el diseño visual del home
- Implementación de filtros o búsqueda
- Modificación de otros componentes del home

---

## Criterios de aceptación (Given / When / Then)

### 1) Animales destacados - más antiguos primero

- **Dado** que existen animales en la base de datos con diferentes fechas de creación
- **Cuando** se carga la página de inicio
- **Entonces** se muestran primero los animales más antiguos (fecha de creación ascendente)
- **Y** se limita a un número máximo de 12 animales destacados
- **Y** solo se muestran animales con `is_published = true`

### 2) Fundaciones destacadas - más animales publicados

- **Dado** que existen fundaciones con diferentes cantidades de animales
- **Cuando** se carga la página de inicio
- **Entonces** se muestran las fundaciones que tienen más animales publicados
- **Y** se limita a un número máximo de 6 fundaciones destacadas
- **Y** solo se consideran fundaciones con animales `is_published = true`

### 3) Datos reales vs mock

- **Dado** que la aplicación está conectada a Supabase
- **Cuando** se carga la página de inicio
- **Entonces** los datos mostrados provienen de la base de datos real
- **Y** no se utilizan datos mock para animales y fundaciones destacadas

### 4) Manejo de errores

- **Dado** que ocurre un error al cargar los datos desde Supabase
- **Cuando** se carga la página de inicio
- **Entonces** se muestra un mensaje de error amigable al usuario
- **Y** se mantiene la funcionalidad básica de la página

---

## Reglas técnicas

### Arquitectura
- Presentation solo consume UseCases vía IoC (no importa repositorios concretos)
- Domain no importa React/Next/MUI/Tailwind/Supabase
- Infrastructure contiene implementaciones y wiring IoC
- Supabase solo vive en Infrastructure

### Consultas SQL
- Animales destacados: `SELECT * FROM animals WHERE is_published = true ORDER BY created_at ASC LIMIT 12`
- Fundaciones destacadas: Query que cuenta animales por fundación y ordena por cantidad descendente

### UI
- UI con MUI existente (no cambiar componentes visuales)
- Tailwind para layout/spacing/responsive utilities
- Mantener estructura de componentes existente

### Traducciones
- **TODOS los textos visibles en la UI deben estar traducidos** (español e inglés)
- Usar el sistema de traducciones configurado en HU-016 (`next-intl`)
- Agregar traducciones en `src/messages/es/home.json` y `src/messages/en/home.json`

---

## Implementación sugerida

### Estructura de archivos sugerida:

```
src/domain/
├── models/
│   ├── HomeAnimals.ts (existente)
│   └── FeaturedFoundation.ts (nuevo)
├── repositories/
│   ├── IAnimalRepository.ts (modificar)
│   └── IFoundationRepository.ts (modificar)
└── usecases/
    ├── animals/
    │   └── GetHomeAnimalsUseCase.ts (modificar)
    └── foundations/
        └── GetFeaturedFoundationsUseCase.ts (nuevo)

src/infrastructure/
├── repositories/
│   ├── AnimalRepository.ts (modificar getHomeAnimals)
│   └── FoundationRepository.ts (agregar getFeaturedFoundations)
└── ioc/ (actualizar bindings)

src/presentation/
└── app/[locale]/page.tsx (modificar para usar datos reales)
```

### Pasos de implementación:

1. **Modificar `IAnimalRepository`**:
   - Actualizar `getHomeAnimals()` para que devuelva datos reales en lugar de mock

2. **Crear `FeaturedFoundation` model**:
   ```typescript
   export interface FeaturedFoundation {
     id: string;
     name: string;
     logoUrl: string | null;
     city: string | null;
     country: string | null;
     animalsCount: number;
   }
   ```

3. **Agregar método en `IFoundationRepository`**:
   - `getFeaturedFoundations(limit: number): Promise<FeaturedFoundation[]>`

4. **Crear `GetFeaturedFoundationsUseCase`**:
   - Obtiene fundaciones con más animales publicados

5. **Implementar en repositorios**:
   - `AnimalRepository.getHomeAnimals()`: Query con ORDER BY created_at ASC
   - `FoundationRepository.getFeaturedFoundations()`: Query con COUNT y GROUP BY

6. **Actualizar página home**:
   - Consumir ambos UseCases
   - Manejar estados de loading y error

7. **Agregar traducciones**:
   - Mensajes de error
   - Textos de secciones si es necesario

---

## Notas de implementación

- Priorizar animales más antiguos para facilitar su adopción
- Mostrar fundaciones más activas para darles visibilidad
- Mantener la experiencia visual existente
- Implementar manejo de errores robusto
- Considerar paginación futura si hay muchos datos