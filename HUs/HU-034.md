# HU-034 — Modal Genérico de Eliminación + Eliminar Producto

**Como** usuario de una fundación  
**Quiero** eliminar un producto con confirmación  
**Para** evitar eliminaciones accidentales en la Tienda Solidaria

---

## Dependencias

- HU-011 (Conexión a Supabase configurada)
- HU-016 (Sistema de traducciones configurado)
- HU-018 (Layout del dashboard de fundaciones con sidebar) - **REQUERIDO**
- HU-029 (Gestión de productos) - **REQUERIDO**
- HU-032 (Modal genérico de eliminación) - **REQUERIDO**

---

## Contexto / Notas

- Esta HU reutiliza el **modal genérico de eliminación** (HU-032) para productos.
- El diseño del modal está en `docs/design/delete_generic_screen.png` y `docs/design/delete_generic_.html`.
- La eliminación real se realiza en Supabase (`products`).
- El usuario solo puede eliminar productos de su propia fundación.

Modelo de datos:
- `products`: `id`, `foundation_id`, `name`, `is_published`

---

## Diseño (OBLIGATORIO)

Referencias:
- Diseño: `docs/design/delete_generic_.html`
- Imagen: `docs/design/delete_generic_screen.png`
- Design System: `docs/design/system.md`

Reglas:
- Reutilizar el modal genérico.
- Textos específicos para producto.
- Botón primario rojo para confirmar.

---

## Alcance

Incluye:
- Integrar modal genérico en gestión de productos
- Abrir modal al hacer clic en “Delete”
- Eliminar producto en Supabase
- Refrescar la tabla
- Estados de loading y error
- Traducciones completas (ES/EN)

No incluye:
- Undo de eliminación
- Eliminación de otras entidades
- Tests automatizados

---

## Criterios de aceptación (Given / When / Then)

### 1) Modal de confirmación para producto

- **Dado** un producto en la tabla
- **Cuando** hago clic en eliminar
- **Entonces** se abre el modal genérico con texto de producto

---

### 2) Eliminación en Supabase

- **Dado** confirmación del usuario
- **Cuando** confirmo “Sí, eliminar”
- **Entonces** el producto se elimina en Supabase
- **Y** desaparece de la tabla

---

### 3) Restricción por fundación

- **Dado** un usuario de fundación
- **Cuando** elimina un producto
- **Entonces** solo puede eliminar productos de su propia fundación

---

### 4) Estados de loading y error

- **Dado** que se elimina un producto
- **Cuando** Supabase procesa la solicitud
- **Entonces** se muestra loading
- **Y** si hay error se muestra mensaje traducido

---

### 5) Traducciones

- **Dado** la UI implementada
- **Cuando** se revisa el código
- **Entonces** los textos usan `useTranslations`
- **Y** existen traducciones en `src/messages/es/common.json` y `src/messages/en/common.json`

---

## Reglas técnicas

### Arquitectura
- Presentation solo consume UseCases vía IoC.
- Domain no importa React/Next/MUI/Tailwind/Inversify/Supabase.
- Infrastructure contiene implementaciones y wiring IoC.
- Supabase solo vive en Infrastructure.

### Supabase / Eliminación
- `DELETE FROM products WHERE id = :id AND foundation_id = :foundationId`

### Traducciones
- Usar namespace `common` (modal genérico).

---

## Implementación sugerida

```
src/presentation/components/common/ConfirmDeleteModal.tsx (reutilizado)

src/domain/
└── usecases/products/
    └── DeleteProductUseCase.ts

src/infrastructure/
└── repositories/
    └── ProductRepository.ts (deleteProduct)
```

---

## Validación

Comandos mínimos:
- `npm run dev`
- `npm run build`

Verificaciones:
- Modal se ve igual al diseño
- Eliminación funciona
- Traducciones completas

---

## Definición de Hecho

- [ ] Criterios de aceptación cumplidos
- [ ] `npm run dev` OK
- [ ] `npm run build` OK
- [ ] Eliminación de productos funciona
- [ ] Modal genérico reutilizado
- [ ] Traducciones incluidas (ES/EN)
- [ ] Sin violaciones de capas
- [ ] Sin cambios fuera del alcance
- Commit sugerido:
  `feat: add delete product flow using generic modal`

